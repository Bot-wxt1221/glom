# Initialization macros:
AC_INIT(glom/main.cc)

AM_CONFIG_HEADER(config.h)

# Package name and version number:
AM_INIT_AUTOMAKE(glom, 1.0.4)

AM_MAINTAINER_MODE

# Checks for programs:
AC_PROG_CC
AC_PROG_CXX
AM_PROG_LIBTOOL
AM_SANITY_CHECK

#Internationalisation:
GETTEXT_PACKAGE=glom
AC_SUBST(GETTEXT_PACKAGE)
AC_DEFINE_UNQUOTED([GETTEXT_PACKAGE], ["$GETTEXT_PACKAGE"],
		   [The domain name to use with gettext.])

ALL_LINGUAS="ca cs de en_CA en_GB es fi fr gu it ne nl pa pt pt_BR rw sq sv tr vi zh_CN"

AM_GLIB_GNU_GETTEXT
IT_PROG_INTLTOOL([0.35.0])

#AC_CONFIG_AUX_DIR(macros)
AC_SUBST([ACLOCAL_AMFLAGS], ['-I macros ${ACLOCAL_FLAGS}'])

#For gnome-doc-utils:
GNOME_DOC_INIT

AC_LANG_CPLUSPLUS

# Checks for libraries
# We need libgnome only for gnome_help_display().:
PKG_CHECK_MODULES(GLOM, bakery-2.4 >= 2.3.18 gtkmm-2.4 >= 2.6.1 gthread-2.0 gnome-vfsmm-2.6 >= 2.11.1 libgnomecanvasmm-2.6 >= 2.10.0 libxslt >= 1.1.10 pygda-1.2 pygtk-2.0 >= 2.6.0 libgnome-2.0 >= 2.6.0 iso-codes libgdamm-2.0 >= 1.3.7 )

GLOM_LIBS+=" --no-undefined"
AC_SUBST(GLOM_CFLAGS)
AC_SUBST(GLOM_LIBS)

#Get the location of the ISO-Codes (currencies, languages) files:
AC_DEFINE_UNQUOTED([ISO_CODES_PREFIX],["`$PKG_CONFIG --variable=prefix iso-codes`"],[ISO codes prefix])

# Get the CFLAGS and LIBS for python's embedding API:
AM_CHECK_PYTHON_HEADERS(,[AC_MSG_ERROR(could not find Python headers)])


# Install path for DTD (e.g. /usr/local/share/glom):

#I would like to use this line, but it doesn't fully evaluate.
#It appears in config.h as "${prefix}/share/glom"
#So I hard-code "share" instead.
#GLOM_DTD_INSTALL_DIR="\"${datadir}/${PACKAGE}\""

GLOM_DTD_INSTALL_DIR="\"${prefix}/share/${PACKAGE}\""
AC_DEFINE_UNQUOTED(GLOM_DTD_INSTALL_DIR, $GLOM_DTD_INSTALL_DIR, "definition of GLOM_DTD_INSTALL_DIR")

# Evaluate the --enable-warnings=level option.
GLOM_ARG_ENABLE_WARNINGS()

# Generate Makefiles, configuration files and scripts:
AC_OUTPUT(Makefile \
  docs/Makefile \
    docs/user-guide/Makefile \
  glom/Makefile \
    glom/libglom/Makefile \
      glom/libglom/data_structure/Makefile \
        glom/libglom/data_structure/layout/Makefile \
          glom/libglom/data_structure/layout/report_parts/Makefile \
      glom/libglom/document/Makefile \
      glom/libglom/python_embed/Makefile \
    glom/layout_item_dialogs/Makefile \
    glom/mode_data/Makefile \
    glom/mode_design/Makefile \
      glom/mode_design/fields/Makefile \
      glom/mode_design/users/Makefile \
    glom/mode_find/Makefile \
    glom/navigation/Makefile \
    glom/utility_widgets/Makefile \
      glom/utility_widgets/adddel/Makefile \
        glom/utility_widgets/adddel/eggcolumnchooser/Makefile \
      glom/utility_widgets/db_adddel/Makefile \
      glom/python_embed/Makefile \
        glom/python_embed/python_module/Makefile \
    glom/relationships_overview/Makefile \
    glom/reports/Makefile \
    glom/translation/Makefile \
    icons/Makefile \
    xslt/Makefile \
    po/Makefile.in \
  macros/Makefile \
  examples/Makefile \
  glom.desktop.in
)
